<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Venelin Mitov" />

<meta name="date" content="2025-09-01" />

<title>The PCMBase Parametrization API</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">

div.csl-bib-body { }
div.csl-entry {
clear: both;
margin-bottom: 0em;
}
.hanging div.csl-entry {
margin-left:2em;
text-indent:-2em;
}
div.csl-left-margin {
min-width:2em;
float:left;
}
div.csl-right-inline {
margin-left:2em;
padding-left:1em;
}
div.csl-indent {
margin-left: 2em;
}
</style>

<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">The PCMBase Parametrization API</h1>
<h4 class="author">Venelin Mitov</h4>
<h4 class="date">2025-09-01</h4>


<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#generic-functions-for-pcm-parameters" id="toc-generic-functions-for-pcm-parameters">Generic functions for PCM
parameters</a></li>
<li><a href="#parameter-s3-class" id="toc-parameter-s3-class">Parameter
S3 class</a>
<ul>
<li><a href="#main-type" id="toc-main-type">Main type</a></li>
<li><a href="#scope" id="toc-scope">Scope</a></li>
<li><a href="#omission" id="toc-omission">Omission</a></li>
<li><a href="#constancy" id="toc-constancy">Constancy</a></li>
<li><a href="#transformation" id="toc-transformation">Transformation</a></li>
<li><a href="#other-restrictions" id="toc-other-restrictions">Other
restrictions</a></li>
</ul></li>
<li><a href="#generating-model-parametrizations" id="toc-generating-model-parametrizations">Generating model
parametrizations</a></li>
<li><a href="#references" id="toc-references">References</a></li>
</ul>
</div>

<!--
# Copyright 2016-2021 Venelin Mitov
#
# This file is part of PCMBase.
#
# PCMBase is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# PCMBase is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with PCMBase.  If not, see <http://www.gnu.org/licenses/>.
-->
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(<span class="at">echo =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(PCMBase)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>FLAGSuggestsAvailable <span class="ot">&lt;-</span> PCMBase<span class="sc">::</span><span class="fu">RequireSuggestedPackages</span>()</span></code></pre></div>
<pre><code>## PCMBase: The following suggested packages could not be loaded: ggtree. The vignette generation and unit tests may fail to execute.</code></pre>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>Model parameters are the key object of interest in every phylogenetic
comparative method. PCMBase provides a powerful interface for specifying
and manipulating model parameters. This interface is based on the S3
object system (see <a href="http://adv-r.had.co.nz/S3.html" class="uri">http://adv-r.had.co.nz/S3.html</a> for an excellent
introduction by Hadley Wickham).</p>
<p>In PCMBase, every model is an object of an S3 class, such as “OU”,
inheriting from the base S3-class “PCM”. A PCM object represents a named
list. Each element of that list can be one of the following:</p>
<ul>
<li>a global parameter shared by all regimes in the model. For example,
this would be the case for a non-heritable variance-covariance parameter
<span class="math inline">\(\Sigma_{e}\)</span> if it is assumed to be
the same for every observed species (i.e. tip) in the tree.</li>
<li>a local stacked parameter that has a different value for each regime
in the model. For example, in an OU model, the selection strength matrix
<span class="math inline">\(H\)</span> has a different value for each of
the <span class="math inline">\(R\)</span> regimes in the model.
Therefore, an OU model contains a <span class="math inline">\(k\times
k\times R\)</span> array member called “H”. The element
<code>H[,,1]</code> would correspond to regime 1, <code>H[,,2]</code> to
regime 2, etc. As a second example, the long-term optimum parameter of
an OU process is a <span class="math inline">\(k\)</span>-dimensional
vector <span class="math inline">\(\vec{\theta}_{r}\)</span> for each
regime in the model. In an OU model with <span class="math inline">\(R\)</span> regimes, this would be represented by a
<span class="math inline">\(k\times R\)</span> array (matrix) called
“Theta”, such that the vector <code>Theta[, 1]</code> corresponds to
regime 1. Finally, a local scalar parameter (i.e. a number), would be
represented by an <span class="math inline">\(R\)</span>-vector.</li>
<li>a nested PCM object corresponding to a regime. This is the case for
a mixed Gaussian phylogenetic model, where different types of Gaussian
processes can be acting on different parts of the tree, represented by
different regimes.</li>
</ul>
</div>
<div id="generic-functions-for-pcm-parameters" class="section level1">
<h1>Generic functions for PCM parameters</h1>
<p>The parametrization API provides the following S3 generic
functions:</p>
<ul>
<li><a href="https://venelin.github.io/PCMBase/reference/PCMParamLoadOrStore.html"><code>PCMParamLoadOrStore</code></a>:
Loading the parameters of a model from a numerical vector or storing
them into a vector.</li>
<li><a href="https://venelin.github.io/PCMBase/reference/PCMParamCount.html"><code>PCMParamCount</code></a>:
counting the parameters of a model;</li>
<li><a href="https://venelin.github.io/PCMBase/reference/PCMParamGetShortVector.html"><code>PCMParamGetShortVector</code></a>:
Getting all values of the model parameters as a numeric vector;</li>
<li><a href="https://venelin.github.io/PCMBase/reference/PCMParamLowerLimit.html"><code>PCMParamLowerLimit</code></a>,
<a href="https://venelin.github.io/PCMBase/reference/PCMParamUpperLimit.html"><code>PCMParamUpperLimit</code></a>:
Upper and lower limit for the parameters of a model;</li>
<li><a href="https://venelin.github.io/PCMBase/reference/PCMApplyTransformation.html"><code>PCMApplyTransformation</code></a>:
transforming a parameter.</li>
</ul>
<p>All of the above generic functions can be called both on individual
parameters, as well as on PCM objects. When called on a PCM object, the
function will be called recursively on each parameter within the object.
The behaviour of the above generic functions is specified by the
parameter’s S3 class attribute described in the following section.</p>
</div>
<div id="parameter-s3-class" class="section level1">
<h1>Parameter S3 class</h1>
<p>Parameters can be numeric vectors, matrices or cubes
(i.e. 3-dimensional arrays) with a “class” attribute specifying a set of
S3 classes. The S3 classes of a parameter control the parameter’s:</p>
<div id="main-type" class="section level2">
<h2>Main type</h2>
<p>The main type specifies the mathematical character of the parameter,
i.e. as what does the parameter enter in the equations defining the
model. The main type S3 class is mandatory and can be one of the
following: “ScalarParameter”, “VectorParameter” and “MatrixParameter”.
Here’s an example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>OU <span class="ot">&lt;-</span> <span class="fu">PCM</span>(<span class="st">&quot;OU&quot;</span>, <span class="at">k =</span> <span class="dv">3</span>, <span class="at">regimes =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">class</span>(OU<span class="sc">$</span>X0)</span></code></pre></div>
<pre><code>## [1] &quot;VectorParameter&quot; &quot;_Global&quot;         &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">class</span>(OU<span class="sc">$</span>H)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">class</span>(OU<span class="sc">$</span>Theta)</span></code></pre></div>
<pre><code>## [1] &quot;VectorParameter&quot; &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">class</span>(OU<span class="sc">$</span>Sigma_x)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">class</span>(OU<span class="sc">$</span>Sigmae_x)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;</code></pre>
</div>
<div id="scope" class="section level2">
<h2>Scope</h2>
<p>Every parameter can be global, i.e. having the same value for each
regime in a model, or local, i.e. having a different value for each
regime. A parameter is assumed to be local scope, unless its class
attribute includes the class “_Global”. For instance, in the above code
example, the root trait value <code>X0</code> has a global scope.
Another example would be an OU model with a global selection strength,
drift and non-heritable variance matrices:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>OU2 <span class="ot">&lt;-</span> <span class="fu">PCM</span>(</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">paste0</span>(</span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>    <span class="st">&quot;OU_&quot;</span>, </span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>    <span class="st">&quot;_Global_X0_&quot;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>    <span class="st">&quot;_Global_H_&quot;</span>,</span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>    <span class="st">&quot;_Theta_&quot;</span>,</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>    <span class="st">&quot;_UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigma_x_&quot;</span>,</span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>    <span class="st">&quot;_UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;</span>), </span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">3</span>, <span class="at">regimes =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a><span class="fu">class</span>(OU2<span class="sc">$</span>X0)</span></code></pre></div>
<pre><code>## [1] &quot;VectorParameter&quot; &quot;_Global&quot;         &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">class</span>(OU2<span class="sc">$</span>H)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot; &quot;_Global&quot;         &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">class</span>(OU2<span class="sc">$</span>Theta)</span></code></pre></div>
<pre><code>## [1] &quot;VectorParameter&quot; &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">class</span>(OU2<span class="sc">$</span>Sigma_x)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;     &quot;_Global&quot;                     
## [5] &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="fu">class</span>(OU2<span class="sc">$</span>Sigmae_x)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;     &quot;_Global&quot;                     
## [5] &quot;matrix&quot;</code></pre>
</div>
<div id="omission" class="section level2">
<h2>Omission</h2>
<p>In some cases, a parameter has to be omitted, i.e. not present in a
model. For example, if a mixed Gaussian model has a global parameter
<span class="math inline">\(\Sigma_{e}\)</span>, then having a local
scope parameter <span class="math inline">\(\Sigma_{e}\)</span> for each
regime represents a non-identifiable case, i.e. infinitely many
different combinations of values for the global and local scope <span class="math inline">\(\Sigma_{e}\)</span> parameters would fit equally
well to the data. To prevent this, it is possible to specify that the
local parameter <span class="math inline">\(\Sigma_{e}\)</span> should
be omitted from each regime. This is done by including “_Omitted” in the
class attribute of the parameter. Here is an example:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>BMOU <span class="ot">&lt;-</span> <span class="fu">MixedGaussian</span>(</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">3</span>, </span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="at">modelTypes =</span> <span class="fu">c</span>(</span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>    <span class="st">&quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;</span>,</span>
<span id="cb23-5"><a href="#cb23-5" tabindex="-1"></a>    <span class="st">&quot;OU__Omitted_X0__H__Theta__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;</span>),</span>
<span id="cb23-6"><a href="#cb23-6" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>))</span>
<span id="cb23-7"><a href="#cb23-7" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" tabindex="-1"></a><span class="fu">class</span>(BMOU<span class="sc">$</span>X0)</span></code></pre></div>
<pre><code>## [1] &quot;VectorParameter&quot; &quot;_Global&quot;         &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="fu">class</span>(BMOU<span class="sc">$</span>Sigmae_x)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;     &quot;_Global&quot;                     
## [5] &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># There are no X0 and Sigmae_x parameters for the regimes because they are omitted:</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a><span class="fu">names</span>(BMOU<span class="sc">$</span>a)</span></code></pre></div>
<pre><code>## [1] &quot;Sigma_x&quot;</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="fu">names</span>(BMOU<span class="sc">$</span>b)</span></code></pre></div>
<pre><code>## [1] &quot;H&quot;       &quot;Theta&quot;   &quot;Sigma_x&quot;</code></pre>
</div>
<div id="constancy" class="section level2">
<h2>Constancy</h2>
<p>In some cases, a parameter will have a known and fixed value.
Constant classes include: “_Fixed”, “_Ones”, “_Zeros”, “_Identity”. For
example, in a mixed Gaussian model, we can specify a fixed value for the
global parameter <code>Sigmae_x</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>BMOU2 <span class="ot">&lt;-</span> <span class="fu">MixedGaussian</span>(</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">3</span>, </span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="at">modelTypes =</span> <span class="fu">c</span>(</span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>    <span class="st">&quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;</span>,</span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>    <span class="st">&quot;OU__Omitted_X0__H__Theta__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;</span>),</span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">c</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>), </span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a>  <span class="at">Sigmae_x =</span> <span class="fu">structure</span>(<span class="dv">0</span>, </span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a>    <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;MatrixParameter&quot;</span>,</span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a>              <span class="st">&quot;_UpperTriangularWithDiagonal&quot;</span>, <span class="st">&quot;_WithNonNegativeDiagonal&quot;</span>, <span class="st">&quot;_Fixed&quot;</span>, <span class="st">&quot;_Global&quot;</span>),</span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a>    <span class="at">description =</span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a>      <span class="st">&quot;A fixed upper triangular factor of the non-phylogenetic variance-covariance&quot;</span>))</span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a>BMOU2<span class="sc">$</span>Sigmae_x[] <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a>    <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.02</span>, <span class="dv">0</span>),</span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.01</span>),</span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.1</span>))</span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="fu">class</span>(BMOU2<span class="sc">$</span>X0)</span></code></pre></div>
<pre><code>## [1] &quot;VectorParameter&quot; &quot;_Global&quot;         &quot;numeric&quot;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="fu">class</span>(BMOU2<span class="sc">$</span>Sigmae_x)</span></code></pre></div>
<pre><code>## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;     &quot;_Fixed&quot;                      
## [5] &quot;_Global&quot;                      &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># There are no X0 and Sigmae_x parameters for the regimes because they are omitted:</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a><span class="fu">names</span>(BMOU2<span class="sc">$</span>a)</span></code></pre></div>
<pre><code>## [1] &quot;Sigma_x&quot;</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a><span class="fu">names</span>(BMOU2<span class="sc">$</span>b)</span></code></pre></div>
<pre><code>## [1] &quot;H&quot;       &quot;Theta&quot;   &quot;Sigma_x&quot;</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="co"># Notice that the BMOU model created in the previous example has more parameters than BMOU2:</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a><span class="fu">PCMParamCount</span>(BMOU)</span></code></pre></div>
<pre><code>## [1] 33</code></pre>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="fu">PCMParamCount</span>(BMOU2)</span></code></pre></div>
<pre><code>## [1] 27</code></pre>
</div>
<div id="transformation" class="section level2">
<h2>Transformation</h2>
<p>Due to constraints arising from their mathematical formulation or to
facilitate the biological interpretation, the parameters of Gaussian
models are often subject to restrictions. For example, the <span class="math inline">\(k\times k\)</span> matrix parameter <span class="math inline">\(\mathbf{\Sigma}\)</span> of a BM or an OU process
should always be a symmetric positive-definite matrix; the selection
strength matrix <span class="math inline">\(\mathbf{H}\)</span> of an OU
process is usually restricted to be at least semi-positive-definite (but
not necessarily symmetric), in order to limit the interpretation to
cases of stabilizing selection rather than (usually unidentifiable)
cases of repulsion. Such parameter restrictions can pose a challenge,
during a parameter inference procedure, since many of the proposed
parameter values may violate some of the imposed restrictions. For most
of the <a href="https://venelin.github.io/PCMBase/articles/PCMBase.html"><span class="math inline">\(\mathcal{G}_{LInv}\)</span> models</a> known to
us, the common restrictions can be handled using an appropriate
parametrization with a transformation applied to the parameters before
calculating the functions <span class="math inline">\(\vec{\omega}\)</span>, <span class="math inline">\(\mathbf{\Phi}\)</span> and <span class="math inline">\(\mathbf{V}\)</span> and the model likelihood.</p>
<p>By default, the parameters named <code>Sigma_x</code>,
<code>Sigmae_x</code> and <code>Sigmaj_x</code> are always transformed
using the formula <span class="math inline">\(\mathbf{\Sigma} =
\mathbf{\Sigma}_{x}\mathbf{\Sigma}_{x}^T\)</span> (see also the runtim
option “PCMBase.Transpose.Sigma_x” in <code>?PCMOptions</code> for
changing the above default behavior).</p>
<p>For other parameters, to specify that a parameter should be
transformed, its class and the class of the encompassing PCM object(s)
must include “_Transformable”. A further S3 class for the parameter
specifies the type of transformation. Once a parameter is transformed
via a call to the generic function <code>PCMApplyTransformation</code>,
the “_Transformable” class is removed, i.e. the returned parameter is
not transformable. For convenience, the name of the transformed
parameter is kept the same as the name of the untransformed one.
Currently the following transformations are defined:</p>
<div id="choleskyfactor" class="section level3">
<h3>_CholeskyFactor</h3>
<p>If a matrix parameter <span class="math inline">\(\mathbf{S}\)</span>
has the classes “_CholeskyFactor” and “_Transformable”, it will be
transformed as <span class="math inline">\(\mathbf{S}^{T}\mathbf{S}\)</span>. Note that this
is analogical but not equivalent to the transformation <span class="math inline">\(\mathbf{S}\mathbf{S}^T\)</span>, which is the
default for the parameters <code>Sigma_x</code> (see above). The
transformed parameter will have classes “_SemiPositiveDefinite” and
“_Transformed”:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">structure</span>(</span>
<span id="cb43-2"><a href="#cb43-2" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">1.2</span>),</span>
<span id="cb43-3"><a href="#cb43-3" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.02</span>),</span>
<span id="cb43-4"><a href="#cb43-4" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">1.02</span>)),</span>
<span id="cb43-5"><a href="#cb43-5" tabindex="-1"></a>  <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;MatrixParameter&quot;</span>, <span class="st">&quot;_CholeskyFactor&quot;</span>, <span class="st">&quot;_Transformable&quot;</span>, <span class="st">&quot;_Global&quot;</span>))</span>
<span id="cb43-6"><a href="#cb43-6" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" tabindex="-1"></a>Mtransf <span class="ot">&lt;-</span> <span class="fu">PCMApplyTransformation</span>(M)</span>
<span id="cb43-8"><a href="#cb43-8" tabindex="-1"></a>Mtransf</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,] 0.04 0.10 0.24
## [2,] 0.10 0.26 0.60
## [3,] 0.24 0.60 2.48
## attr(,&quot;class&quot;)
## [1] &quot;MatrixParameter&quot;       &quot;_Global&quot;               &quot;_SemiPositiveDefinite&quot;
## [4] &quot;_Transformed&quot;          &quot;matrix&quot;</code></pre>
</div>
<div id="schur" class="section level3">
<h3>_Schur</h3>
<p>If both, the positive-definiteness and the symmetry of a matrix
parameter are optional, e.g. the matrix <span class="math inline">\(\mathbf{H}\)</span> of an OU process, such
restrictions can be imposed through a Schur decomposition as shown
previously by <span class="citation">(Clavel, Escarguel, and Merceron
2015)</span>. Specifically, we define a <span class="math inline">\(k\times k\)</span>-dimensional matrix <span class="math inline">\(\mathbf{H}_{S}\)</span> as follows:</p>
<ul>
<li>the upper triangle of <span class="math inline">\(\mathbf{H}_{S}\)</span>, excluding the diagonal,
specifies <span class="math inline">\(k(k-1)/2\)</span> rotation angles
for Givens rotations <span class="citation">(Golub and Van Loan
2013)</span> to obtain a <span class="math inline">\(k\times
k\)</span>-dimensional orthoganal matrix <span class="math inline">\(\mathbf{Q}\)</span>;</li>
<li>the lower triangle of <span class="math inline">\(\mathbf{H}_{S}\)</span> including the diagonal
defines a <span class="math inline">\(k\times k\)</span> triangular
matrix <span class="math inline">\(\mathbf{T}\)</span>.</li>
</ul>
<p>Then, <span class="math inline">\(\mathbf{H}\)</span> is obtained
from <span class="math inline">\(\mathbf{Q}\)</span> and <span class="math inline">\(\mathbf{T}\)</span> as follows <span class="citation">(Clavel, Escarguel, and Merceron 2015)</span>: <span class="math display">\[
\mathbf{H}=\mathbf{Q}\mathbf{T}^{T}\mathbf{Q}^{T}
\]</span> The matrix <span class="math inline">\(\mathbf{H}\)</span>
calculated in this way has all of its eigenvalues equal to the elements
on the diagonal of <span class="math inline">\(\mathbf{H}_{S}\)</span>
<span class="citation">(Clavel, Escarguel, and Merceron 2015)</span>.
Thus, by restricting the diagonal of <span class="math inline">\(\mathbf{H}_{S}\)</span> to non-negative or
strictly positive values, we guarantee that <span class="math inline">\(\mathbf{H}\)</span> will have all of its
eigenvalues non-negative or strictly positive (hence, guaranteeing semi-
or strict positive definiteness). Further, if <span class="math inline">\(\mathbf{H}_{S}\)</span> is diagonal, then so is
the matrix <span class="math inline">\(\mathbf{H}\)</span>; if <span class="math inline">\(\mathbf{H}_{S}\)</span> is upper triangular, then
<span class="math inline">\(\mathbf{T}\)</span> is diagonal and the
resulting matrix <span class="math inline">\(\mathbf{H}\)</span> is
symmetric. Finally, if <span class="math inline">\(\mathbf{H}_{S}\)</span> is neither diagonal nor
triangular, then the resulting matrix <span class="math inline">\(\mathbf{H}\)</span> is asymmetric. Here is an
example:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a><span class="co"># Diagonal</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>Hs1 <span class="ot">&lt;-</span> <span class="fu">structure</span>(</span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="fl">0.2</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">1.02</span>)),</span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>  <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;MatrixParameter&quot;</span>, <span class="st">&quot;_Schur&quot;</span>, <span class="st">&quot;_Transformable&quot;</span>, <span class="st">&quot;_Global&quot;</span>))</span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a><span class="fu">PCMApplyTransformation</span>(Hs1)</span></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]  0.2    0    0
## [2,]  0.0    0    0
## [3,]  0.0    0    1
## attr(,&quot;class&quot;)
## [1] &quot;MatrixParameter&quot; &quot;_Global&quot;         &quot;_Transformed&quot;    &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co"># Symmetric positive definite with eigenvalues 1.02, 0.1 and 0.02</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>Hs2 <span class="ot">&lt;-</span> <span class="fu">structure</span>(</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>, <span class="fl">1.2</span>),</span>
<span id="cb47-4"><a href="#cb47-4" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.1</span>, <span class="fl">0.02</span>),</span>
<span id="cb47-5"><a href="#cb47-5" tabindex="-1"></a>        <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">0.02</span>)),</span>
<span id="cb47-6"><a href="#cb47-6" tabindex="-1"></a>  <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;MatrixParameter&quot;</span>, <span class="st">&quot;_Schur&quot;</span>, <span class="st">&quot;_Transformable&quot;</span>, <span class="st">&quot;_Global&quot;</span>))</span>
<span id="cb47-7"><a href="#cb47-7" tabindex="-1"></a></span>
<span id="cb47-8"><a href="#cb47-8" tabindex="-1"></a><span class="fu">PCMApplyTransformation</span>(Hs2)</span></code></pre></div>
<pre><code>##        [,1]   [,2]  [,3]
## [1,]  0.348 -0.089 -0.45
## [2,] -0.089  0.132  0.16
## [3,] -0.453  0.159  0.66
## attr(,&quot;class&quot;)
## [1] &quot;MatrixParameter&quot; &quot;_Global&quot;         &quot;_Transformed&quot;    &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a><span class="fu">eigen</span>(<span class="fu">PCMApplyTransformation</span>(Hs2))<span class="sc">$</span>values</span></code></pre></div>
<pre><code>## [1] 1.02 0.10 0.02</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="co"># Asymmetric positive definite with eigenvalues 1.02, 0.1 and 0.02</span></span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a>Hs3 <span class="ot">&lt;-</span> <span class="fu">structure</span>(</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>, <span class="fl">1.2</span>),</span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a>        <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.1</span>, <span class="fl">0.02</span>),</span>
<span id="cb51-5"><a href="#cb51-5" tabindex="-1"></a>        <span class="fu">c</span>(<span class="fl">0.8</span>, <span class="fl">0.1</span>, <span class="fl">0.02</span>)),</span>
<span id="cb51-6"><a href="#cb51-6" tabindex="-1"></a>  <span class="at">class =</span> <span class="fu">c</span>(<span class="st">&quot;MatrixParameter&quot;</span>, <span class="st">&quot;_Schur&quot;</span>, <span class="st">&quot;_Transformable&quot;</span>, <span class="st">&quot;_Global&quot;</span>))</span>
<span id="cb51-7"><a href="#cb51-7" tabindex="-1"></a></span>
<span id="cb51-8"><a href="#cb51-8" tabindex="-1"></a><span class="fu">PCMApplyTransformation</span>(Hs3)</span></code></pre></div>
<pre><code>##       [,1]  [,2]  [,3]
## [1,]  0.75 -0.10 -0.16
## [2,] -0.15  0.11  0.12
## [3,] -0.99  0.17  0.28
## attr(,&quot;class&quot;)
## [1] &quot;MatrixParameter&quot; &quot;_Global&quot;         &quot;_Transformed&quot;    &quot;matrix&quot;</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">eigen</span>(<span class="fu">PCMApplyTransformation</span>(Hs3))<span class="sc">$</span>values</span></code></pre></div>
<pre><code>## [1] 1.02 0.10 0.02</code></pre>
</div>
</div>
<div id="other-restrictions" class="section level2">
<h2>Other restrictions</h2>
<p>We may need to specify other restrictions for a parameter. For
example, by definition the matrix parameters <code>Sigma_x</code> and
<code>Sigmae_x</code> are required to be upper triangular with
non-negative diagonal elements <span class="citation">(Mitov et al.
2019)</span>. Restriction classes include: ’_AllEqual’, ’_NonNegative’,
’_WithNonNegativeDiagonal’, ’_LowerTriangular’,
’_LowerTriangularWithDiagonal’, ’_UpperTriangular’,
’_UpperTriangularWithDiagonal’, ’_Symmetric’ and ’_ScalarDiagonal’.</p>
</div>
</div>
<div id="generating-model-parametrizations" class="section level1">
<h1>Generating model parametrizations</h1>
<p>It can be helpful to examine the structure of a 3-regime bivariate BM
model:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>modelObject <span class="ot">&lt;-</span> <span class="fu">PCM</span>(<span class="st">&quot;BM&quot;</span>, <span class="at">k =</span> <span class="dv">2</span><span class="dt">L</span>, <span class="at">regimes =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a><span class="co"># let&#39;s assign some values to the model parameters:</span></span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">PCMParamCount</span>(modelObject))</span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a><span class="fu">PCMParamLoadOrStore</span>(modelObject, vec, <span class="at">offset =</span> <span class="dv">0</span>, <span class="at">load=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a><span class="fu">str</span>(modelObject)</span></code></pre></div>
<pre><code>## List of 3
##  $ X0      : &#39;VectorParameter&#39; num [1:2] 1 2
##   ..- attr(*, &quot;description&quot;)= chr &quot;trait values at the root&quot;
##  $ Sigma_x : &#39;MatrixParameter&#39; num [1:2, 1:2, 1:3] 3 0 4 5 6 0 7 8 9 0 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 3
##   .. ..$ : NULL
##   .. ..$ : NULL
##   .. ..$ : chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;
##   ..- attr(*, &quot;description&quot;)= chr &quot;factor of the unit-time variance rate&quot;
##  $ Sigmae_x: &#39;MatrixParameter&#39; num [1:2, 1:2, 1:3] 12 0 13 14 15 0 16 17 18 0 ...
##   ..- attr(*, &quot;dimnames&quot;)=List of 3
##   .. ..$ : NULL
##   .. ..$ : NULL
##   .. ..$ : chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;
##   ..- attr(*, &quot;description&quot;)= chr &quot;factor of the non-heritable variance or the variance of the measurement error&quot;
##  - attr(*, &quot;class&quot;)= chr [1:3] &quot;BM&quot; &quot;GaussianPCM&quot; &quot;PCM&quot;
##  - attr(*, &quot;k&quot;)= int 2
##  - attr(*, &quot;regimes&quot;)= chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;
##  - attr(*, &quot;spec&quot;)=List of 3
##   ..$ X0      : &#39;VectorParameter&#39; num 0
##   .. ..- attr(*, &quot;description&quot;)= chr &quot;trait values at the root&quot;
##   ..$ Sigma_x : &#39;MatrixParameter&#39; num 0
##   .. ..- attr(*, &quot;description&quot;)= chr &quot;factor of the unit-time variance rate&quot;
##   ..$ Sigmae_x: &#39;MatrixParameter&#39; num 0
##   .. ..- attr(*, &quot;description&quot;)= chr &quot;factor of the non-heritable variance or the variance of the measurement error&quot;
##   ..- attr(*, &quot;class&quot;)= chr [1:3] &quot;BM&quot; &quot;GaussianPCM&quot; &quot;PCM&quot;
##   ..- attr(*, &quot;k&quot;)= int 2
##   ..- attr(*, &quot;regimes&quot;)= chr [1:3] &quot;a&quot; &quot;b&quot; &quot;c&quot;
##  - attr(*, &quot;p&quot;)= int 20
##  - attr(*, &quot;modelTypes&quot;)= chr &quot;BM&quot;
##  - attr(*, &quot;mapping&quot;)= int 1</code></pre>
<p>Now let’s print the model parameters as a table:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">1</span>)</span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a><span class="fu">print</span>(</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a>  <span class="fu">PCMTable</span>(modelObject, <span class="at">addTransformed =</span> <span class="cn">FALSE</span>, <span class="at">removeUntransformed =</span> <span class="cn">FALSE</span>), </span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>  <span class="at">xtable =</span> <span class="cn">TRUE</span>, <span class="at">type=</span><span class="st">&#39;html&#39;</span>)</span></code></pre></div>
<table border="1">
<tr>
<th>
regime
</th>
<th>
<span class="math inline">\(X0\)</span>
</th>
<th>
<span class="math inline">\(\Sigma_{x}\)</span>
</th>
<th>
<span class="math inline">\(\Sigma_{e,x}\)</span>
</th>
</tr>
<tr>
<td align="right">
:global:
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  1.0 \\   2.0
\\   \end{bmatrix}\)</span>
</td>
<td align="right">
</td>
<td align="right">
</td>
</tr>
<br />

<tr>
<td align="right">
a
</td>
<td align="right">
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  3.0 &amp; 4.0 \\   0.0
&amp; 5.0 \\   \end{bmatrix}\)</span>
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  12.0 &amp; 13.0 \\   0.0
&amp; 14.0 \\   \end{bmatrix}\)</span>
</td>
</tr>
<br />

<tr>
<td align="right">
b
</td>
<td align="right">
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  6.0 &amp; 7.0 \\   0.0
&amp; 8.0 \\   \end{bmatrix}\)</span>
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  15.0 &amp; 16.0 \\   0.0
&amp; 17.0 \\   \end{bmatrix}\)</span>
</td>
</tr>
<br />

<tr>
<td align="right">
c
</td>
<td align="right">
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  9.0 &amp; 10.0 \\   0.0
&amp; 11.0 \\   \end{bmatrix}\)</span>
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  18.0 &amp; 19.0 \\   0.0
&amp; 20.0 \\   \end{bmatrix}\)</span>
</td>
</tr>
</table>
<p>We notice that the parameter <span class="math inline">\(\Sigma_{e,x}\)</span> is local for each regime in
the model. In the context of a biological application, it can be more
appropriate to assume that this parameter is shared by all regimes.
Moreover, in many cases, e.g. when testing hypotheses about the presence
of correlation between the traits, it can be necessary to assume that
the matrices <span class="math inline">\(\Sigma_{x}\)</span> and <span class="math inline">\(\Sigma_{e,x}\)</span> are diagonal, meaning that
the model assumes trait independence. Biologically, that would mean that
any correlation between the traits originates from genetic (not
environmental) factors. To specify such a scenario, first, we look at
the list of available BM model types.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">PCMModels</span>(<span class="at">parentClass =</span> <span class="st">&quot;BM&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;BM&quot;                                                                                                                                              
##  [2] &quot;BM__Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                       
##  [3] &quot;BM__Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                    
##  [4] &quot;BM__Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                           
##  [5] &quot;BM__Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                 
##  [6] &quot;BM__Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;              
##  [7] &quot;BM__Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                     
##  [8] &quot;BM__Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                    
##  [9] &quot;BM__Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot; 
## [10] &quot;BM__Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;        
## [11] &quot;BM__Omitted_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                      
## [12] &quot;BM__Omitted_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                   
## [13] &quot;BM__Omitted_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                          
## [14] &quot;BM__Omitted_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                
## [15] &quot;BM__Omitted_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;             
## [16] &quot;BM__Omitted_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                    
## [17] &quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                   
## [18] &quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;
## [19] &quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;</code></pre>
<p>We notice that the above list does not contain a BM model type with a
global diagonal parameter <code>Sigmae_x</code>. This means that the S3
methods for such a model parametrization have not yet been generated and
loaded. The function <code>PCMListParameterizations</code> returns a
named list, where each named element is a list of the possible S3 class
assignments for the corresponding parameter. So, let’s see what are the
available S3 classes for the parameter <code>Sigmae_x</code> of a BM
model:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="fu">PCMListParameterizations</span>(<span class="fu">structure</span>(<span class="fl">0.0</span>, <span class="at">class=</span><span class="st">&quot;BM&quot;</span>))<span class="sc">$</span>Sigmae_x</span></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;    
## 
## [[2]]
## [1] &quot;MatrixParameter&quot;          &quot;_Diagonal&quot;               
## [3] &quot;_WithNonNegativeDiagonal&quot;
## 
## [[3]]
## [1] &quot;MatrixParameter&quot;          &quot;_ScalarDiagonal&quot;         
## [3] &quot;_WithNonNegativeDiagonal&quot;
## 
## [[4]]
## [1] &quot;MatrixParameter&quot;              &quot;_UpperTriangularWithDiagonal&quot;
## [3] &quot;_WithNonNegativeDiagonal&quot;     &quot;_Global&quot;                     
## 
## [[5]]
## [1] &quot;MatrixParameter&quot;          &quot;_Diagonal&quot;               
## [3] &quot;_WithNonNegativeDiagonal&quot; &quot;_Global&quot;                 
## 
## [[6]]
## [1] &quot;MatrixParameter&quot;          &quot;_ScalarDiagonal&quot;         
## [3] &quot;_WithNonNegativeDiagonal&quot; &quot;_Global&quot;                 
## 
## [[7]]
## [1] &quot;MatrixParameter&quot; &quot;_Omitted&quot;</code></pre>
<p>We notice that, for <code>Sigmae_x</code>, the 5th element above
contains “_Diagonal” and “_Global” in the list of S3-classes. We proceed
to generate all BM parametrizations with this S3-class assignment for
the parameter <code>Sigmae_x</code>.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a><span class="co"># 1. Filter the list of parametrizations to avoid generating too many S3 methods.</span></span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a><span class="co"># (note that we could do the same type of filtering for the other parameters).</span></span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>listParameterizationsBM <span class="ot">&lt;-</span> <span class="fu">PCMListParameterizations</span>(<span class="fu">structure</span>(<span class="fl">0.0</span>, <span class="at">class=</span><span class="st">&quot;BM&quot;</span>))</span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>listParameterizationsBM<span class="sc">$</span>Sigmae_x <span class="ot">&lt;-</span> listParameterizationsBM<span class="sc">$</span>Sigmae_x[<span class="dv">5</span>]</span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>  </span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a><span class="co"># 2. Generate a table of parametrizations for this list:</span></span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a>dtParameterizations <span class="ot">&lt;-</span> <span class="fu">PCMTableParameterizations</span>(</span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a>  <span class="fu">structure</span>(<span class="fl">0.0</span>, <span class="at">class=</span><span class="st">&quot;BM&quot;</span>), <span class="at">listParameterizations =</span> listParameterizationsBM)</span>
<span id="cb64-9"><a href="#cb64-9" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" tabindex="-1"></a><span class="fu">print</span>(dtParameterizations)</span></code></pre></div>
<pre><code>##                                    X0
##                                &lt;list&gt;
##  1:           VectorParameter,_Global
##  2:    VectorParameter,_Fixed,_Global
##  3: VectorParameter,_AllEqual,_Global
##  4:          VectorParameter,_Omitted
##  5:           VectorParameter,_Global
##  6:    VectorParameter,_Fixed,_Global
##  7: VectorParameter,_AllEqual,_Global
##  8:          VectorParameter,_Omitted
##  9:           VectorParameter,_Global
## 10:    VectorParameter,_Fixed,_Global
## 11: VectorParameter,_AllEqual,_Global
## 12:          VectorParameter,_Omitted
##                                                                   Sigma_x
##                                                                    &lt;list&gt;
##  1: MatrixParameter,_UpperTriangularWithDiagonal,_WithNonNegativeDiagonal
##  2: MatrixParameter,_UpperTriangularWithDiagonal,_WithNonNegativeDiagonal
##  3: MatrixParameter,_UpperTriangularWithDiagonal,_WithNonNegativeDiagonal
##  4: MatrixParameter,_UpperTriangularWithDiagonal,_WithNonNegativeDiagonal
##  5:                    MatrixParameter,_Diagonal,_WithNonNegativeDiagonal
##  6:                    MatrixParameter,_Diagonal,_WithNonNegativeDiagonal
##  7:                    MatrixParameter,_Diagonal,_WithNonNegativeDiagonal
##  8:                    MatrixParameter,_Diagonal,_WithNonNegativeDiagonal
##  9:              MatrixParameter,_ScalarDiagonal,_WithNonNegativeDiagonal
## 10:              MatrixParameter,_ScalarDiagonal,_WithNonNegativeDiagonal
## 11:              MatrixParameter,_ScalarDiagonal,_WithNonNegativeDiagonal
## 12:              MatrixParameter,_ScalarDiagonal,_WithNonNegativeDiagonal
##                                                       Sigmae_x
##                                                         &lt;list&gt;
##  1: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  2: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  3: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  4: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  5: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  6: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  7: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  8: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
##  9: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
## 10: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
## 11: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global
## 12: MatrixParameter,_Diagonal,_WithNonNegativeDiagonal,_Global</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a><span class="co"># 3. Generate the parametrizations (optionally, we could select a subset of the</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a><span class="co"># rows in the data.table)</span></span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a><span class="fu">PCMGenerateParameterizations</span>(<span class="fu">structure</span>(<span class="fl">0.0</span>, <span class="at">class=</span><span class="st">&quot;BM&quot;</span>), </span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a>                             <span class="at">tableParameterizations =</span> dtParameterizations[])</span></code></pre></div>
<p>Now the list of BM-models contains the generated model types with a
diagonal <code>Sigma_x</code> and a global diagonal
<code>Sigmae_x</code>:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="fu">PCMModels</span>(<span class="st">&quot;BM&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;BM&quot;                                                                                                                                              
##  [2] &quot;BM__AllEqual_Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                              
##  [3] &quot;BM__AllEqual_Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                        
##  [4] &quot;BM__AllEqual_Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;           
##  [5] &quot;BM__Fixed_Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                                 
##  [6] &quot;BM__Fixed_Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                           
##  [7] &quot;BM__Fixed_Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;              
##  [8] &quot;BM__Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                                       
##  [9] &quot;BM__Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                       
## [10] &quot;BM__Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                    
## [11] &quot;BM__Global_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                           
## [12] &quot;BM__Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                                 
## [13] &quot;BM__Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                 
## [14] &quot;BM__Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;              
## [15] &quot;BM__Global_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                     
## [16] &quot;BM__Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                    
## [17] &quot;BM__Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                    
## [18] &quot;BM__Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot; 
## [19] &quot;BM__Global_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;        
## [20] &quot;BM__Omitted_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                                      
## [21] &quot;BM__Omitted_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                      
## [22] &quot;BM__Omitted_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                   
## [23] &quot;BM__Omitted_X0__Diagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                          
## [24] &quot;BM__Omitted_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                                
## [25] &quot;BM__Omitted_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                                
## [26] &quot;BM__Omitted_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;             
## [27] &quot;BM__Omitted_X0__ScalarDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;                    
## [28] &quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;                   
## [29] &quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__Omitted_Sigmae_x&quot;                                                   
## [30] &quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;
## [31] &quot;BM__Omitted_X0__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigma_x__UpperTriangularWithDiagonal_WithNonNegativeDiagonal_Sigmae_x&quot;       
## [32] &quot;BM_drift&quot;</code></pre>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>BMModelGlobalSigmae <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>  <span class="st">&quot;BM&quot;</span> , </span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a>  <span class="st">&quot;__Global_X0&quot;</span>, </span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>  <span class="st">&quot;__Diagonal_WithNonNegativeDiagonal_Sigma_x&quot;</span>, </span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>  <span class="st">&quot;__Diagonal_WithNonNegativeDiagonal_Global_Sigmae_x&quot;</span>)</span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a></span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>modelObject2 <span class="ot">&lt;-</span> <span class="fu">PCM</span>(BMModelGlobalSigmae, <span class="at">k =</span> <span class="dv">2</span>, <span class="at">regimes =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a>vec <span class="ot">&lt;-</span> <span class="fu">seq_len</span>(<span class="fu">PCMParamCount</span>(modelObject2))</span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a><span class="fu">PCMParamLoadOrStore</span>(modelObject2, vec, <span class="at">offset =</span> <span class="dv">0</span>, <span class="at">load=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>[1] 10</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="fu">print</span>(</span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a>  <span class="fu">PCMTable</span>(modelObject2, <span class="at">addTransformed =</span> <span class="cn">FALSE</span>, <span class="at">removeUntransformed =</span> <span class="cn">FALSE</span>), </span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a>  <span class="at">xtable =</span> <span class="cn">TRUE</span>, <span class="at">type=</span><span class="st">&#39;html&#39;</span>)                 </span></code></pre></div>
<table border="1">
<tr>
<th>
regime
</th>
<th>
<span class="math inline">\(X0\)</span>
</th>
<th>
<span class="math inline">\(\Sigma_{e,x}\)</span>
</th>
<th>
<span class="math inline">\(\Sigma_{x}\)</span>
</th>
</tr>
<tr>
<td align="right">
:global:
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  1.0 \\   2.0
\\   \end{bmatrix}\)</span>
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  9.0 &amp; 0.0 \\   0.0
&amp; 10.0 \\   \end{bmatrix}\)</span>
</td>
<td align="right">
</td>
</tr>
<br />

<tr>
<td align="right">
a
</td>
<td align="right">
</td>
<td align="right">
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  3.0 &amp; 0.0 \\   0.0
&amp; 4.0 \\   \end{bmatrix}\)</span>
</td>
</tr>
<br />

<tr>
<td align="right">
b
</td>
<td align="right">
</td>
<td align="right">
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  5.0 &amp; 0.0 \\   0.0
&amp; 6.0 \\   \end{bmatrix}\)</span>
</td>
</tr>
<br />

<tr>
<td align="right">
c
</td>
<td align="right">
</td>
<td align="right">
</td>
<td align="right">
<span class="math inline">\(\begin{bmatrix}{}  7.0 &amp; 0.0 \\   0.0
&amp; 8.0 \\   \end{bmatrix}\)</span>
</td>
</tr>
</table>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-Clavel:2015hc" class="csl-entry">
Clavel, Julien, Gilles Escarguel, and Gildas Merceron. 2015.
<span>“<span class="nocase">mvmorph: an R package for fitting
multivariate evolutionary models to morphometric data</span>.”</span>
<em>Methods in Ecology and Evolution</em> 6 (11): 1311–19.
</div>
<div id="ref-Golub:2013mc" class="csl-entry">
Golub, G H, and C F Van Loan. 2013. <em><span>Matrix
Computations</span></em>. Baltimore: The Johns Hopkins University Press.
</div>
<div id="ref-Mitov:2018fl" class="csl-entry">
Mitov, Venelin, Krzysztof Bartoszek, Georgios Asimomitis, and Tanja
Stadler. 2019. <span>“<span class="nocase">Fast likelihood calculation
for multivariate Gaussian phylogenetic models with
shifts</span>.”</span> <em>Theor. Popul. Biol.</em>, December. <a href="https://doi.org/10.1016/j.tpb.2019.11.005">https://doi.org/10.1016/j.tpb.2019.11.005</a>.
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
